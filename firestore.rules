rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    function signedIn() { return request.auth != null; }
    function isOwner(ownerId) { return signedIn() && request.auth.uid == ownerId; }

    // Users: each user can read all basic profiles, write only their own doc
    match /users/{uid} {
      allow read: if true;
      allow create: if signedIn() && request.resource.data.uid == request.auth.uid;
      allow update, delete: if isOwner(uid);
    }

    // Hives: anyone can read; create requires auth; updates/deletes by owner
    match /hives/{hiveId} {
      allow read: if true;
      allow create: if signedIn() && request.resource.data.ownerId == request.auth.uid;
      allow update, delete: if isOwner(resource.data.ownerId);
    }

    // Buzz posts: read all; create requires auth; author can update/delete
    match /buzz/{buzzId} {
      allow read: if true;
      allow create: if signedIn() && request.resource.data.authorId == request.auth.uid;
      allow update, delete: if isOwner(resource.data.authorId);
    }

    // Hive attendees: read all; create requires auth; allow user to remove their own RSVP
    match /hive_attendees/{attId} {
      allow read: if true;
      allow create: if signedIn() && request.resource.data.userId == request.auth.uid;
      allow delete: if isOwner(resource.data.userId);
      allow update: if false; // immutable attendance docs
    }
  }
}